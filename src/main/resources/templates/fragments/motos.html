<!DOCTYPE html>
<html lang="pt-BR" data-theme="light" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout(~{::title}, ~{::main}, ~{::pageScripts})}">
<head>
    <title th:text="${pageTitleKey}">Mottu - Motos</title>
</head>
<body>
<main class="flex-grow p-6 bg-[#1b1c1f] overflow-y-auto">

    <!-- Cabeçalho -->
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-white" th:text="#{moto.page.header}">Gerenciamento de Motos</h2>
        <a class="btn btn-outline border-white text-white hover:bg-white/10"
           th:href="@{/index}" th:text="#{moto.botao.voltar}">Voltar</a>
    </div>

    <!-- Flash messages -->
    <div th:if="${message}" class="mb-4 alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="mb-4 alert alert-error" th:text="${error}"></div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- CARD: FORM (CREATE / EDIT) -->
        <div class="bg-[#232428] rounded-xl shadow-lg border border-[var(--color-primary)]">
            <div class="border-b border-gray-700 px-6 py-4">
                <h3 class="text-lg font-semibold text-white"
                    th:text="${motoDto.id} == null ? #{moto.form.title.create} : #{moto.form.title.edit}">
                    Cadastrar Moto
                </h3>
            </div>

            <div class="p-6">
                <form th:action="${motoDto.id} == null ? @{/motos} : @{/motos/{id}(id=${motoDto.id})}"
                      method="post" th:object="${motoDto}" class="space-y-6">
                    <!-- CSRF -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- Expor id no contexto (não editável) -->
                    <input type="hidden" th:field="*{id}" th:if="${motoDto.id != null}"/>

                    <!-- Simular PUT quando editar -->
                    <input type="hidden" name="_method" value="put" th:if="${motoDto.id != null}"/>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Modelo -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.modelo} + ' *'">Modelo *</label>
                            <select th:field="*{modelo}" class="select w-full bg-[#2a2a2e] text-white border-gray-700">
                                <option disabled value="" th:text="#{moto.label.modelo.select}">Selecione</option>
                                <option value="MOTTU-E">MOTTU-E</option>
                                <option value="MOTTUPOP">MOTTU POP</option>
                                <option value="MOTTUSPORT">MOTTU SPORT</option>
                            </select>
                            <p th:if="${#fields.hasErrors('modelo')}" th:errors="*{modelo}" class="text-red-500 text-sm mt-1"></p>
                        </div>

                        <!-- Placa -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.placa} + ' *'">Placa *</label>
                            <input type="text" th:field="*{placa}" class="input w-full bg-[#2a2a2e] text-white border-gray-700"/>
                            <p th:if="${#fields.hasErrors('placa')}" th:errors="*{placa}" class="text-red-500 text-sm mt-1"></p>
                        </div>

                        <!-- Chassi -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.chassi} + ' *'">Chassi *</label>
                            <input type="text" th:field="*{chassi}" class="input w-full bg-[#2a2a2e] text-white border-gray-700"/>
                            <p th:if="${#fields.hasErrors('chassi')}" th:errors="*{chassi}" class="text-red-500 text-sm mt-1"></p>
                        </div>

                        <!-- Status -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.status}">Status</label>
                            <select th:field="*{status}" class="select w-full bg-[#2a2a2e] text-white border-gray-700">
                                <option disabled value="" th:text="#{moto.label.status.select}">Selecione</option>
                                <option value="D" th:text="#{moto.status.disponivel}">Disponível</option>
                                <option value="A" th:text="#{moto.status.alugada}">Alugada</option>
                                <option value="M" th:text="#{moto.status.manutencao}">Manutenção</option>
                                <option value="I" th:text="#{moto.status.inativa}">Inativa</option>
                            </select>
                            <p th:if="${#fields.hasErrors('status')}" th:errors="*{status}" class="text-red-500 text-sm mt-1"></p>
                        </div>

                        <!-- Pátio -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.patio}">Pátio</label>
                            <select th:field="*{idPatio}" class="select w-full bg-[#2a2a2e] text-white border-gray-700">
                                <option disabled value="" th:text="#{moto.label.patio.select}">Selecione</option>
                                <option th:each="p : ${patios}" th:value="${p.idPatio}" th:text="${p.nmPatio}"></option>
                            </select>
                            <p th:if="${#fields.hasErrors('idPatio')}" th:errors="*{idPatio}" class="text-red-500 text-sm mt-1"></p>
                        </div>

                        <!-- Operador -->
                        <div class="form-control">
                            <label class="label text-white" th:text="#{moto.campo.operador}">Operador</label>
                            <select th:field="*{idOperador}" class="select w-full bg-[#2a2a2e] text-white border-gray-700">
                                <option disabled value="" th:text="#{moto.label.operador.select}">Selecione</option>
                                <option th:each="o : ${operadores}" th:value="${o.idOperador}" th:text="${o.nome}"></option>
                            </select>
                            <p th:if="${#fields.hasErrors('idOperador')}" th:errors="*{idOperador}" class="text-red-500 text-sm mt-1"></p>
                        </div>
                    </div>

                    <!-- Ações: salvar/limpar/cancelar + botão excluir condicional -->
                    <div class="flex justify-between items-center gap-3 pt-4 border-t border-gray-700">
                        <div class="flex gap-3">
                            <a th:if="${motoDto.id != null}" th:href="@{/motos}"
                               class="btn btn-outline text-white border-white hover:bg-white/10" th:text="#{moto.botao.cancelar}">Cancelar</a>
                            <button type="reset" class="btn btn-outline text-white border-white hover:bg-white/10" th:text="#{moto.botao.limpar}">Limpar</button>
                        </div>

                        <div class="flex gap-3 items-center">
                            <!-- Delete: visível somente em edição -->
                            <form th:if="${motoDto.id != null}"
                                  th:action="@{/motos/{id}(id=${motoDto.id})}"
                                  method="post"
                                  onsubmit="return confirmDelete();">
                                <input type="hidden" name="_method" value="delete"/>
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="btn btn-error btn-sm" th:text="#{moto.botao.deletar}">Deletar</button>
                            </form>

                            <!-- Submit (create/update) -->
                            <button type="submit"
                                    class="btn bg-[var(--color-primary)] text-white hover:bg-green-600"
                                    th:text="${motoDto.id} == null ? #{moto.botao.cadastrar} : #{moto.botao.atualizar}">
                                Cadastrar
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- CARD: LISTAGEM -->
        <div class="bg-[#232428] rounded-xl shadow-lg border border-[var(--color-primary)]">
            <div class="flex justify-between items-center border-b border-gray-700 px-6 py-4">
                <h3 class="text-lg font-semibold text-white" th:text="#{moto.list.title}">Lista de Motos</h3>

                <!-- Search + filter (frontend, ligar ao controller se quiser) -->
                <div class="flex gap-2">
                    <form th:action="@{/motos}" method="get" class="flex gap-2 items-center">
                        <input name="q" type="text" placeholder="Pesquisar..." class="input input-sm bg-[#2a2a2e] text-white border-gray-700" th:value="${param.q}"/>
                        <select name="status" class="select select-sm bg-[#2a2a2e] text-white border-gray-700" th:value="${param.status}">
                            <option value="">Todos</option>
                            <option value="D" th:text="#{moto.status.disponivel}">Disponível</option>
                            <option value="A" th:text="#{moto.status.alugada}">Alugada</option>
                            <option value="M" th:text="#{moto.status.manutencao}">Manutenção</option>
                            <option value="I" th:text="#{moto.status.inativa}">Inativa</option>
                        </select>
                        <button type="submit" class="btn btn-sm btn-outline">OK</button>
                    </form>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="table table-zebra w-full text-sm text-white">
                    <thead class="bg-[#2a2a2e]">
                    <tr>
                        <th th:text="#{moto.form.modelo}">Modelo</th>
                        <th th:text="#{moto.form.placa}">Placa</th>
                        <th th:text="#{moto.form.patio}">Pátio</th>
                        <th th:text="#{moto.form.operador}">Operador</th>
                        <th th:text="#{moto.list.actions}">Ações</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="m : ${motos}">
                        <td th:text="${m.nmModelo != null ? m.nmModelo : m.modelo != null ? m.modelo : '-'}">Modelo</td>
                        <td th:text="${m.nrPlaca}">Placa</td>
                        <td th:text="${m.idPatio != null ? m.patio.nmPatio : '-'}">Pátio</td>
                        <td th:text="${m.idOperador != null ? m.operador.nome : '-'}">Operador</td>
                        <td>
                            <div class="flex gap-2">
                                <!-- Edit: carrega a view com motoDto preenchido (GET /motos/{id}) -->
                                <a th:href="@{/motos/{id}(id=${m.idMoto})}" class="btn btn-xs btn-warning" th:text="#{moto.action.edit}">Editar</a>

                                <!-- Delete per row: confirma e envia POST + _method=delete -->
                                <form th:action="@{/motos/{id}(id=${m.idMoto})}" method="post"
                                      th:onsubmit="return confirm('Deseja excluir esta moto?');" style="display:inline">
                                    <input type="hidden" name="_method" value="delete"/>
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button type="submit" class="btn btn-xs btn-error" th:text="#{moto.action.delete}">Excluir</button>
                                </form>
                            </div>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(motos)}">
                        <td colspan="5" class="py-6 text-center text-gray-400" th:text="#{moto.list.empty}">Nenhuma moto cadastrada</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</main>

<th:block th:fragment="pageScripts">
    <script th:inline="javascript">
        /*<![CDATA[*/
        function confirmDelete() {
            return confirm(/*[[#{moto.confirm.delete}]]*/ 'Deseja realmente excluir esta moto?');
        }
        /*]]>*/
    </script>
</th:block>
</body>
</html>
